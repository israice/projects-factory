<!DOCTYPE html>
<html>
<head>
    <title>GitHub Repositories</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="header-wrapper">
        <div style="flex:1;display:flex;flex-direction:column">
            <div id="panel-1" class="navbar">
                <a href="#">ğŸ‘¨ User: {{ username }}</a>
                <a href="#">ğŸ“¦ Repos: {{ count }}</a>
                <a href="#" id="installed-count">ğŸ“ Installed: {{ installed_count }}</a>
            </div>
            <div id="panel-2" class="navbar">
                <!-- Panel 2 content -->
            </div>
            <div id="panel-3" class="header">
                <span class="welcome-text" id="welcome-text">Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ, ĞœĞ°ÑÑ‚ĞµÑ€</span>
            </div>
            <div id="log-panel" class="header">
            </div>
        </div>
        <div class="logo-wrapper">
            <div class="logo-container" id="avatar-container" style="cursor:pointer;position:relative">
                {% if avatar_url %}
                <img src="{{ avatar_url }}" alt="Logo" class="logo-img">
                {% else %}
                <span class="logo-icon">ğŸ“¦</span>
                {% endif %}
                <div id="avatar-menu" class="avatar-menu" style="display:none">
                    <a href="/create-new">â• Create New</a>
                    <a href="/refresh">ğŸ”„ Refresh</a>
                </div>
            </div>
        </div>
    </div>
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal">
            <h3>Confirm Installation</h3>
            <div class="modal-body" id="modal-repo-list"></div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="modal-cancel">Cancel</button>
                <button class="modal-btn modal-btn-confirm" id="modal-confirm">Install</button>
            </div>
        </div>
    </div>
    <div id="delete-modal" class="modal-overlay">
        <div class="modal">
            <h3>Confirm Deletion</h3>
            <div class="modal-body" id="modal-delete-repo-list"></div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="modal-delete-cancel">Cancel</button>
                <button class="modal-btn modal-btn-confirm" id="modal-delete-confirm" style="background:#dc3545">Delete</button>
            </div>
        </div>
    </div>
    <table>
        <tr>
            <th>Logo</th>
            <th class="sortable" data-sort="name">Projets</th>
            <th class="sortable" data-sort="description">Description</th>
            <th class="sortable" data-sort="url">URL</th>
            <th class="sortable" data-sort="created_at">Started</th>
        </tr>
        {% for repo in repos %}
        {% set normalized_url = repo.url[:-4] if repo.url.endswith('.git') else repo.url %}
        {% set normalized_url = normalized_url.rstrip('/') %}
        {% set is_installed = normalized_url in installed_repos %}
        {% set is_new_project = repo.get('is_new_project', False) %}
        <tr{% if is_new_project %} class="new-project-row"{% elif is_installed %} class="installed-row"{% endif %}>
            <td class="logo-cell">
                {% if avatar_url %}
                <img src="{{ avatar_url }}" alt="Logo" class="repo-logo">
                {% else %}
                <span class="logo-icon" style="font-size:32px">ğŸ“¦</span>
                {% endif %}
            </td>
            <td class="name-cell" data-repo="{{ repo.name }}" data-url="{{ repo.url }}" title="Click to install/delete">{{ repo.name }}</td>
            <td>{{ repo.description or "" }}</td>
            <td class="url-cell"><a href="{{ repo.url }}" class="url-link" data-url="{{ repo.url }}" data-is-local="{{ 'true' if is_new_project else 'false' }}">{% if is_new_project %}ğŸ“{% else %}{{ "ğŸ”’" if repo.private else "ğŸŒ" }}{% endif %}</a></td>
            <td><span class="date-badge">{{ repo.created_at[:10] if repo.created_at and repo.created_at else "" }}<br>{{ repo.created_at[11:19] if repo.created_at and repo.created_at and repo.created_at|length > 11 else "" }}</span></td>
        </tr>
        {% endfor %}
    </table>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
